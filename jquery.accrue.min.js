/*
 * Accrue.js
 * http://accruejs.com
 * Author: James Pederson (jpederson.com)
 * Licensed under the MIT, GPL licenses.
 * Version: 1.1.0
 */(function(e,t,n,r){e.extend(e.fn,{accrue:function(t){t=e.extend({calculationMethod:s},e.fn.accrue.options,t);return this.each(function(){var n=e(this);n.find(".form").length||n.append('<div class="form"></div>');var r=i(n,t,"amount"),a=i(n,t,"rate"),f=i(n,t,"term");if(t.mode=="compare")var l=i(n,t,"rate_compare");if(t.response_output_div===".results"){n.find(".results").length==0&&n.append('<div class="results"></div>');var c=n.find(".results")}else var c=e(t.response_output_div);switch(t.mode){case"basic":var h=s;break;case"compare":var h=o;break;case"amortization":var h=u}h(n,t,c);if(t.operation=="button"){n.find("button").length==0&&n.find(".form").append('<button class="accrue-calculate">'+t.button_label+"</button>");n.find("button, input[type=submit]").each(function(){e(this).click(function(e){e.preventDefault();h(n,t,c)})})}else n.find("input, select").each(function(){e(this).bind("keyup change",function(){h(n,t,c)})});n.find("form").each(function(){e(this).submit(function(e){e.preventDefault();h(n,t,c)})})})}});e.fn.accrue.options={mode:"basic",operation:"keyup",default_values:{amount:"$7,500",rate:"7%",rate_compare:"1.49%",term:"36m"},field_titles:{amount:"Loan Amount",rate:"Rate (APR)",rate_compare:"Comparison Rate",term:"Term"},button_label:"Calculate",field_comments:{amount:"",rate:"",rate_compare:"",term:"Format: 12m, 36m, 3y, 7y"},response_output_div:".results",response_basic:"<p><strong>Monthly Payment:</strong><br />$%payment_amount%</p><p><strong>Number of Payments:</strong><br />%num_payments%</p><p><strong>Total Payments:</strong><br />$%total_payments%</p><p><strong>Total Interest:</strong><br />$%total_interest%</p>",response_compare:"Save $%savings% in interest!",error_text:"Please fill in all fields.",callback:function(e,t){}};var i=function(e,t,n){var r=e.find("."+n).length?e.find("."+n):e.find(".accrue-"+n).length?e.find(".accrue-"+n):e.find("input[name~="+n+"]").length?e.find("input[name~="+n+"]"):"";if(r.length)return r.val();e.find(".form").append('<div class="accrue-field-'+n+'"><p><label>'+t.field_titles[n]+':</label><input type="text" class="'+n+'" value="'+t.default_values[n]+'" />'+(t.field_comments[n].length>0?"<small>"+t.field_comments[n]+"</small>":"")+"</p></div>");return e.find("."+n).val()},s=function(t,n,r){var s=e.loanInfo({amount:i(t,n,"amount"),rate:i(t,n,"rate"),term:i(t,n,"term")});if(s!==0){var o=n.response_basic.replace("%payment_amount%",s.payment_amount_formatted).replace("%num_payments%",s.num_payments).replace("%total_payments%",s.total_payments_formatted).replace("%total_interest%",s.total_interest_formatted);r.html(o)}else r.html('<p class="error">'+n.error_text+"</p>");n.callback(t,s)},o=function(t,n,r){var s=e.loanInfo({amount:i(t,n,"amount"),rate:i(t,n,"rate"),term:i(t,n,"term")}),o=e.loanInfo({amount:i(t,n,"amount"),rate:i(t,n,"rate_compare"),term:i(t,n,"term")}),u={loan_1:s,loan_2:o};if(s!==0&&o!==0){s.total_interest-o.total_interest>0?u.savings=s.total_interest-o.total_interest:u.savings=0;var a=n.response_compare.replace("%savings%",u.savings.toFixed(2));r.html('<p class="total-savings">'+a+"</p>")}else r.html('<p class="error">'+n.error_text+"</p>");n.callback(t,u)},u=function(t,n,r){var s=e.loanInfo({amount:i(t,n,"amount"),rate:i(t,n,"rate"),term:i(t,n,"term")});if(s!==0){var o='<table class="accrue-amortization"><tr><th class="accrue-payment-number">#</th><th class="accrue-payment-amount">Payment Amt.</th><th class="accrue-total-interest">Total Interest</th><th class="accrue-total-payments">Total Payments</th><th class="accrue-balance">Balance</th></tr>',u=s.payment_amount-s.original_amount/s.num_payments,a=s.payment_amount-u;counter_interest=0,counter_payment=0,counter_balance=parseInt(s.original_amount);for(var f=0;f<s.num_payments;f++){counter_interest+=u;counter_payment+=s.payment_amount;counter_balance-=a;var l="td";f==s.num_payments-1&&(l="th");o=o+"<tr>"+"<"+l+' class="accrue-payment-number">'+(f+1)+"</"+l+">"+"<"+l+' class="accrue-payment-amount">$'+s.payment_amount_formatted+"</"+l+">"+"<"+l+' class="accrue-total-interest">$'+counter_interest.toFixed(2)+"</"+l+">"+"<"+l+' class="accrue-total-payments">$'+counter_payment.toFixed(2)+"</"+l+">"+"<"+l+' class="accrue-balance">$'+counter_balance.toFixed(2)+"</"+l+">"+"</tr>"}o+="</table>";r.html(o)}else r.html('<p class="error">'+n.error_text+"</p>");n.callback(t,s)},a=function(e){t.console&&console.log(e)};e.loanInfo=function(e){var t=(typeof e.amount!="undefined"?e.amount:0).replace(/[^\d.]/ig,""),n=(typeof e.rate!="undefined"?e.rate:0).replace(/[^\d.]/ig,""),r=typeof e.term!="undefined"?e.term:0;r.match("y")?r=parseInt(r.replace(/[^\d.]/ig,""))*12:r=parseInt(r.replace(/[^\d.]/ig,""));var i=n/100/12,s=Math.pow(1+i,r),o=t*s*i/(s-1);return t*n*r>0?{original_amount:t,payment_amount:o,payment_amount_formatted:o.toFixed(2),num_payments:r,total_payments:o*r,total_payments_formatted:(o*r).toFixed(2),total_interest:o*r-t,total_interest_formatted:(o*r-t).toFixed(2)}:0}})(jQuery,window,document);